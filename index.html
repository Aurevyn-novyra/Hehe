<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ria ‚Äî Will you be mine?</title>
  <meta name="description" content="A playful romantic proposal for Ria ‚Äî tulips, poem, games and a little clumsy poet." />
  <style>
    :root{
      --bg:#07030a;
      --accent:#ff5ca8;
      --accent2:#ffb4d9;
      --gold:#ffd27f;
      --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.02);
      --text: #fff;
      --ui-size: 14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(255,80,160,0.06), transparent),
                  linear-gradient(180deg,#06020a 0%, #09050f 60%);
      color:var(--text);
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      -webkit-tap-highlight-color: transparent;
    }
    header{
      position:fixed;left:0;right:0;top:0;height:72px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;z-index:60;
      backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-bottom:1px solid rgba(255,255,255,0.03);
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;box-shadow:0 8px 30px rgba(255,80,160,0.12)}
    .logo svg{width:26px;height:26px}
    h1{font-size:16px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    button.btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:var(--accent2);cursor:pointer;font-size:var(--ui-size)}
    button.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border:0;color:#111;font-weight:700}

    main{padding-top:92px;padding-bottom:120px}
    .container{max-width:1100px;margin:20px auto;padding:18px}

    .hero{display:grid;grid-template-columns:1fr 420px;gap:22px;align-items:start}
    .hero-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:20px;box-shadow: 0 10px 50px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03)}
    .lead{font-size:24px;line-height:1.06;color:#fff;margin-bottom:8px}
    .sub{color:rgba(255,255,255,0.6);margin-bottom:14px}

    .poem-wrap{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);min-height:180px;position:relative}
    .poem{white-space:pre-wrap;font-family: "Times New Roman", Georgia, serif;font-size:16px;color:var(--accent2);line-height:1.5}

    .panel{padding:10px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.02);margin-bottom:12px}

    .games{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .game{min-height:140px;display:flex;flex-direction:column;justify-content:center;align-items:center}

    .hearts{display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
    .heart{width:64px;height:64px;border-radius:14px;background:linear-gradient(180deg,#fff3,#fff1);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .22s}
    .heart svg{width:36px;height:36px;filter:drop-shadow(0 6px 12px rgba(255,70,140,0.16));}
    .heart:hover{transform:translateY(-6px) rotate(-4deg);}

    .tulip-area{position:relative;overflow:hidden;height:200px;border-radius:12px}
    .tulip{position:absolute;width:84px;height:120px;cursor:pointer;touch-action:none}

    .meter{display:flex;gap:8px;align-items:center}
    .meter .bar{height:12px;border-radius:10px;background:linear-gradient(90deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));width:200px;overflow:hidden}
    .meter .fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--gold));border-radius:10px;transition:width 1.4s cubic-bezier(.2,.9,.2,1)}
    .meter input{padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff;font-size:var(--ui-size)}

    .puzzle{display:flex;gap:8px}
    .puzzle button{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff;cursor:pointer}

    .mini{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .wheel{display:flex;align-items:center;justify-content:center;flex-direction:column}
    .wheel-canvas{width:140px;height:140px;border-radius:50%;background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.02), transparent);display:flex;align-items:center;justify-content:center;font-size:36px}

    .memory-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .card{background:var(--glass-2);height:68px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:22px;user-select:none}

    .proposal-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,1,6,0.6);backdrop-filter: blur(5px);z-index:120;opacity:0;pointer-events:none;transition:opacity .3s}
    .proposal-modal.show{opacity:1;pointer-events:auto}
    .proposal-card{width:920px;max-width:95%;border-radius:20px;padding:24px;background:linear-gradient(180deg, rgba(10,6,12,0.95), rgba(8,4,10,0.95));border:1px solid rgba(255,255,255,0.03);text-align:center}
    .proposal-card h2{font-size:30px;margin-bottom:12px}
    .proposal-actions{display:flex;gap:12px;justify-content:center;margin-top:18px}
    .big-btn{padding:12px 16px;border-radius:12px;border:0;font-size:16px}
    .yes{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#111}
    .no{background:transparent;border:1px solid rgba(255,255,255,0.06)}

    #petal-canvas{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:2}

    footer{margin-top:24px;text-align:center;color:rgba(255,255,255,0.35);font-size:13px}

    @media (max-width:920px){
      .hero{grid-template-columns:1fr;}
      .hero-card{padding:16px}
      .lead{font-size:20px}
      .poem-wrap{min-height:160px}
      .games{grid-template-columns:1fr}
      .mini{grid-template-columns:1fr}
      .memory-grid{grid-template-columns:repeat(3,1fr)}
      :root{--ui-size:15px}
    }
    @media (max-width:520px){
      header{height:64px;padding:0 12px}
      .logo{width:44px;height:44px}
      .lead{font-size:18px}
      .poem{font-size:15px}
      .heart{width:56px;height:56px}
      .tulip{width:74px;height:104px}
      .card{height:56px}
      :root{--ui-size:16px}
    }
  </style>
</head>
<body>
  <canvas id="petal-canvas" aria-hidden="true"></canvas>

  <header>
    <div class="brand">
      <div class="logo" aria-hidden>
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M32 6c6.6 0 12 5.4 12 12 0 6.6-12 20-12 20s-12-13.4-12-20c0-6.6 5.4-12 12-12z" fill="#fff" opacity=".92"/></svg>
      </div>
      <div>
        <h1>Ria ‚Äî a misprinted bouquet</h1>
        <div style="color:rgba(255,255,255,0.5);font-size:12px">A playful romantic proposal by Priyanshu</div>
      </div>
    </div>
    <div class="controls">
      <button class="btn" id="play-music">Play music</button>
      <button class="btn primary" id="open-propose">Propose</button>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="hero">
        <div class="hero-card">
          <div class="lead">Ria ‚Äî will you walk through this misprinted sky with me?</div>
          <div class="sub">A playful, romantic little world made of tulips, stars, and a clumsy poet.</div>

          <div class="poem-wrap panel" aria-live="polite">
            <div class="poem" id="poem"></div>
          </div>

          <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap;align-items:flex-start">
            <div class="panel" style="flex:1;min-width:220px">
              <div style="font-size:13px;color:rgba(255,255,255,0.6);margin-bottom:8px">Quick games</div>
              <div class="games">
                <div class="game panel">
                  <strong style="display:block;margin-bottom:8px">Find My Heart</strong>
                  <div class="hearts" id="hearts"></div>
                </div>

                <div class="game panel">
                  <strong style="display:block;margin-bottom:8px">Catch the Tulip</strong>
                  <div class="tulip-area" id="tulip-area">
                    <svg class="tulip" id="moving-tulip" viewBox="0 0 64 96" xmlns="http://www.w3.org/2000/svg">
                      <g>
                        <path d="M32 10c10 0 18 8 18 18 0 10-18 30-18 30s-18-20-18-30c0-10 8-18 18-18z" fill="#ff5ca8"/>
                        <path d="M40 56c0 12-16 20-16 20s-16-8-16-20c0-3 16-4 16-4s16 1 16 4z" fill="#5b8c3a"/>
                      </g>
                    </svg>
                  </div>
                </div>

                <div class="game panel">
                  <strong style="display:block;margin-bottom:8px">Compatibility Meter</strong>
                  <div style="display:flex;gap:8px;align-items:center">
                    <input id="name-input" placeholder="Type Ria's name" />
                    <button class="btn" id="calc-compat">Calculate</button>
                  </div>
                  <div style="margin-top:8px" class="meter">
                    <div class="bar"><div class="fill" id="compat-fill"></div></div>
                    <div id="compat-percent">--%</div>
                  </div>
                </div>

                <div class="game panel">
                  <strong style="display:block;margin-bottom:8px">Unlock My Heart</strong>
                  <div class="puzzle">
                    <button data-key="smile">Smile</button>
                    <button data-key="eyes">Eyes</button>
                    <button data-key="heart">Heart</button>
                  </div>
                </div>

              </div>
            </div>

            <div class="panel" style="width:300px;min-width:220px;">
              <div style="font-size:13px;color:rgba(255,255,255,0.6);margin-bottom:8px">More fun</div>
              <div class="mini">
                <div class="panel wheel">
                  <div style="font-size:13px;color:rgba(255,255,255,0.6);margin-bottom:8px">Spin the Tulip</div>
                  <div class="wheel-canvas" id="wheel">üå∑</div>
                  <button class="btn" id="spin-wheel" style="margin-top:8px">Spin</button>
                </div>
                <div class="panel">
                  <div style="font-size:13px;color:rgba(255,255,255,0.6);margin-bottom:8px">Memory Match</div>
                  <div class="memory-grid" id="memory-grid"></div>
                  <button class="btn" id="reset-memory" style="margin-top:8px">Reset</button>
                </div>
              </div>
            </div>

          </div>

        </div>

        <aside class="hero-card panel" aria-hidden>
          <div style="text-align:center;margin-bottom:10px">
            <h3 style="margin:0;font-size:18px;">A little tulip garden</h3>
            <div style="color:rgba(255,255,255,0.6);font-size:12px">For Ria ‚Äî every petal for you</div>
          </div>

          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
            <div class="panel" style="text-align:center">
              <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:8px">Tulip Trail</div>
              <div style="font-size:22px;font-weight:700;color:var(--accent)">üå∑</div>
              <div style="font-size:12px;color:rgba(255,255,255,0.45);margin-top:8px">Petals follow the touch</div>
            </div>
            <div class="panel" style="text-align:center">
              <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:8px">Ring Preview</div>
              <div style="font-size:22px;font-weight:700;color:var(--gold)">üíç</div>
              <div style="font-size:12px;color:rgba(255,255,255,0.45);margin-top:8px">A tiny ring animation</div>
            </div>
            <div class="panel" style="text-align:center">
              <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:8px">Yes Button</div>
              <div style="font-size:22px;font-weight:700;color:var(--accent)">‚úîÔ∏è</div>
              <div style="font-size:12px;color:rgba(255,255,255,0.45);margin-top:8px">Click to accept</div>
            </div>
          </div>

        </aside>
      </section>

      <footer>
        <div>Made with clumsy words, tulips & a little astronomy.</div>
      </footer>
    </div>
  </main>

  <div class="proposal-modal" id="proposal-modal" role="dialog" aria-modal="true">
    <div class="proposal-card">
      <h2 id="proposal-title">Ria‚Ä¶ will you be my forever?</h2>
      <p id="proposal-poem" style="color:rgba(255,255,255,0.78);max-width:720px;margin:0 auto">I wrote a small thing for you.</p>
      <div class="proposal-actions">
        <button class="big-btn yes" id="yes-btn">Yes</button>
        <button class="big-btn no" id="no-btn">No</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    /* ---------- Poem ---------- */
    const poemText = `Sometimes I think I fell for you
before I even learned how falling works.
My words trip over themselves..
And as I said earlier.. you're like a Luminous Singularity
which's parallel yet coincidently intersecting...
Like constellations shuffled in a hurry...
Orion losing its belt..
Cassiopeia sitting upside down..
and whole sky is asking "Why is she the only one shining this bright?"
And I swear ... 
every time i try to explain what you mean to me.. I fumble..I'm scared...
and my heart chooses Your tulips instead of sentences 
petals arranged in a wrong order.. yet beautiful..
Colors mixing where they shouldn't yet somehow looking eternal..
and it's strange how You make the universe feel like a misprinted bouquet..
Galaxies scribbled over with your name..
planets orbiting a little too close..
a pull like the Black hole..
Like they too forgot their distance.
And me? I'm jst a boy holding a bouquet thinking maybe if I say it wrong enough times
you Might hear the truth hidden between the mistakes
That in every star's cold shimmer and every tulip's quite softness
i keep finding you 
not perfectly..
not clearly 
but completely...`;

    const poemEl = document.getElementById('poem');
    let pIndex = 0;
    const typingSpeed = 16;
    function typeStep(){
      if(pIndex <= poemText.length){
        poemEl.textContent = poemText.slice(0,pIndex);
        pIndex++;
        setTimeout(typeStep, typingSpeed);
      }
    }
    typeStep();

    /* ---------- Canvas petals (robust DPR handling) ---------- */
    const canvas = document.getElementById('petal-canvas');
    const ctx = canvas.getContext('2d');
    let DPR = Math.max(1, window.devicePixelRatio || 1);
    function resizeCanvas(){
      DPR = Math.max(1, window.devicePixelRatio || 1);
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
      canvas.width = Math.round(window.innerWidth * DPR);
      canvas.height = Math.round(window.innerHeight * DPR);
      ctx.setTransform(DPR, 0, 0, DPR, 0, 0); // reset transform with DPR scale
    }
    window.addEventListener('resize', resizeCanvas, {passive:true});
    resizeCanvas();

    function rand(a,b){ return a + Math.random()*(b-a); }

    const petals = [];
    function spawnPetal(x,y,force){
      const p = {
        x: x !== undefined ? x : rand(0, window.innerWidth),
        y: y !== undefined ? y : rand(-window.innerHeight, window.innerHeight),
        vx: rand(-0.6,0.6) * (force || 1),
        vy: rand(0.2,1.6) * (force || 1),
        r: rand(6,14),
        rot: rand(0,Math.PI*2),
        vr: rand(-0.02,0.02),
        col: `rgba(255,${120+Math.floor(rand(0,120))},${160+Math.floor(rand(0,80))},${0.95})`
      };
      petals.push(p);
      if(petals.length > 220) petals.splice(0, 20);
    }
    for(let i=0;i<60;i++) spawnPetal();

    function drawPetal(p){
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.beginPath();
      ctx.ellipse(0,0, p.r*0.7, p.r, 0, 0, Math.PI*2);
      ctx.fillStyle = p.col;
      ctx.fill();
      ctx.restore();
    }

    function updatePetals(){
      ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
      for(let i=0;i<petals.length;i++){
        const p = petals[i];
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;
        if(p.y > window.innerHeight + 40){
          p.y = -40;
          p.x = rand(0, window.innerWidth);
        }
        drawPetal(p);
      }
      requestAnimationFrame(updatePetals);
    }
    updatePetals();

    // mouse & touch trails
    let lastTouch = 0;
    window.addEventListener('mousemove', (e) => {
      for(let i=0;i<3;i++) spawnPetal(e.clientX + rand(-12,12), e.clientY + rand(-12,12), 0.6);
    });
    window.addEventListener('touchmove', (ev) => {
      const t = ev.touches[0];
      if(!t) return;
      const now = Date.now();
      if(now - lastTouch > 25){
        for(let i=0;i<4;i++) spawnPetal(t.clientX + rand(-18,18), t.clientY + rand(-18,18), 0.9);
        lastTouch = now;
      }
    }, {passive:true});

    /* ---------- Find My Heart (hearts game) ---------- */
    const heartsEl = document.getElementById('hearts');
    function makeHearts(){
      heartsEl.innerHTML = '';
      const count = 8;
      const correct = Math.floor(Math.random() * count);
      for(let i=0;i<count;i++){
        const d = document.createElement('div');
        d.className = 'heart';
        d.innerHTML = `<svg viewBox="0 0 24 24"><path d="M12 21s-8-4.8-8-10.3S8.1 3 12 6.2 20 3 20 10.7 12 21 12 21z" fill="${i===correct ? '#ff5ca8' : '#ffffff'}" /></svg>`;
        heartsEl.appendChild(d);
        (function(index, el){
          el.addEventListener('click', () => {
            if(index === correct){
              showToast("You found my heart ‚ù§Ô∏è");
              celebrateAtElement(el);
            } else {
              showToast("Not this one ‚Äî try again ‚ò∫Ô∏è");
              el.animate([{transform:'translateY(0)'},{transform:'translateY(-10px) rotate(-6deg)'},{transform:'translateY(0)'}], {duration:420});
            }
          }, {passive:true});
        })(i, d);
      }
    }
    makeHearts();

    function celebrateAtElement(el){
      const rect = el.getBoundingClientRect();
      for(let i=0;i<14;i++){
        const p = document.createElement('div');
        p.style.position = 'fixed';
        p.style.left = (rect.left + rect.width/2) + 'px';
        p.style.top = (rect.top + rect.height/2) + 'px';
        p.style.width = '8px';
        p.style.height = '8px';
        p.style.borderRadius = '4px';
        p.style.background = (i%2) ? 'rgba(255,100,160,0.95)' : 'rgba(255,190,220,0.95)';
        p.style.zIndex = 99999;
        p.style.pointerEvents = 'none';
        document.body.appendChild(p);
        const dx = (Math.random() - 0.5) * 120;
        const dy = (Math.random() - 0.9) * 120;
        p.animate([
          { transform: 'translate(0,0) scale(1)', opacity: 1 },
          { transform: `translate(${dx}px,${dy}px) scale(0.2)`, opacity: 0 }
        ], { duration: 700 + Math.random()*400, easing: 'cubic-bezier(.2,.8,.2,1)' }).onfinish = () => p.remove();
      }
    }

    /* ---------- Tulip mover + click ---------- */
    const tulip = document.getElementById('moving-tulip');
    const tulipArea = document.getElementById('tulip-area');
    let tx = 50, ty = 50, tvx = 1.6, tvy = 0.8;
    function moveTulip(){
      tx += tvx; ty += tvy;
      if(tx < 8 || tx > 92) tvx *= -1;
      if(ty < 12 || ty > 82) tvy *= -1;
      tulip.style.left = tx + '%';
      tulip.style.top = ty + '%';
      requestAnimationFrame(moveTulip);
    }
    moveTulip();

    let tulipClicks = 0;
    tulip.addEventListener('click', () => {
      tulipClicks++;
      const msgs = [
        'This tulip smells like your laugh',
        'Every petal remembers your name',
        'One more tulip for Ria',
        'Your tulips outshine the sky'
      ];
      showToast(msgs[tulipClicks % msgs.length]);
      if(tulipClicks >= 4){
        showToast('You gathered a garden üå∑');
        tulipClicks = 0;
      }
    }, {passive:true});
    tulip.addEventListener('touchstart', (e) => { e.preventDefault(); tulip.click(); }, {passive:false});

    /* ---------- Compatibility meter ---------- */
    const compatFill = document.getElementById('compat-fill');
    const compatPercent = document.getElementById('compat-percent');
    document.getElementById('calc-compat').addEventListener('click', () => {
      const nm = document.getElementById('name-input').value.trim();
      if(!nm){ showToast("Type a name (try Ria)"); return; }
      let h = 0;
      for(let ch of (nm.toLowerCase() + "_priyanshu")) h = (h*31 + ch.charCodeAt(0)) % 1000;
      let val = 92 + (h % 8) + Math.floor(Math.random()*5);
      if(nm.toLowerCase().includes('ria')) val = 100;
      compatFill.style.width = val + '%';
      compatPercent.textContent = val + '%';
      showToast('Compatibility calculated ‚Äî obvious result üòå');
    }, {passive:true});

    /* ---------- Unlock puzzle ---------- */
    const order = ['eyes','smile','heart'];
    let progress = [];
    document.querySelectorAll('.puzzle button').forEach(btn => {
      btn.addEventListener('click', () => {
        const k = btn.dataset.key;
        progress.push(k);
        btn.animate([{transform:'scale(1)'},{transform:'scale(0.92)'}], {duration:140, fill:'forwards'});
        if(progress.length === order.length){
          if(progress.join(',') === order.join(',')){
            showToast('Heart unlocked ‚ù§Ô∏è');
            openProposal();
          } else {
            showToast('Not quite ‚Äî try another combination');
          }
          progress = [];
        }
      }, {passive:true});
    });

    /* ---------- Memory match game ---------- */
    const memoryGrid = document.getElementById('memory-grid');
    const resetMemory = document.getElementById('reset-memory');
    const emojis = ['üå∑','üí´','‚ú®','üíç','üåô','‚≠ê','‚ù§Ô∏è','üïäÔ∏è'];
    let mem = { cards: [], first: null, second: null, lock:false, pairs:0 };
    function setupMemory(){
      memoryGrid.innerHTML = '';
      mem = { cards: [], first: null, second: null, lock:false, pairs:0 };
      const deck = emojis.slice(0,6).concat(emojis.slice(0,6)); // 6 pairs
      // shuffle
      for(let i=deck.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [deck[i], deck[j]]=[deck[j], deck[i]]; }
      deck.forEach(sym => {
        const c = document.createElement('div');
        c.className = 'card';
        c.dataset.sym = sym;
        c.textContent = '';
        c.addEventListener('click', () => {
          if(mem.lock || c === mem.first || c.classList.contains('matched')) return;
          revealCard(c);
        }, {passive:true});
        memoryGrid.appendChild(c);
        mem.cards.push(c);
      });
    }
    function revealCard(c){
      c.textContent = c.dataset.sym;
      c.style.background = 'linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))';
      if(!mem.first) mem.first = c;
      else { mem.second = c; checkMem(); }
    }
    function checkMem(){
      if(mem.first.dataset.sym === mem.second.dataset.sym){
        mem.first.classList.add('matched'); mem.second.classList.add('matched');
        mem.pairs++;
        mem.first = null; mem.second = null;
        showToast('Match! ‚ù§Ô∏è');
        if(mem.pairs >= 6) setTimeout(()=> showToast('You matched the memories ‚Äî ready for the next chapter'), 300);
      } else {
        mem.lock = true;
        setTimeout(()=>{
          mem.first.textContent = ''; mem.second.textContent = '';
          mem.first.style.background = ''; mem.second.style.background = '';
          mem.first = null; mem.second = null; mem.lock = false;
          showToast('Not a match ‚Äî try again');
        }, 800);
      }
    }
    resetMemory.addEventListener('click', setupMemory, {passive:true});
    setupMemory();

    /* ---------- Spin the tulip wheel ---------- */
    const spinBtn = document.getElementById('spin-wheel');
    const wheel = document.getElementById('wheel');
    const wheelMsgs = ['A tulip for your smile','A secret kiss','A future picnic','A starlit dance','A silly promise','A forever'];
    spinBtn.addEventListener('click', () => {
      const spins = 3 + Math.floor(Math.random()*3);
      const angle = 360 * spins + Math.floor(Math.random()*360);
      wheel.animate([{transform:'rotate(0deg)'}, {transform:`rotate(${angle}deg)`}], { duration: 2000 + Math.random()*900, easing: 'cubic-bezier(.2,.9,.2,1)' });
      setTimeout(()=> showToast(wheelMsgs[Math.floor(Math.random()*wheelMsgs.length)]), 1900);
    }, {passive:true});

    /* ---------- Proposal modal ---------- */
    const modal = document.getElementById('proposal-modal');
    document.getElementById('open-propose').addEventListener('click', openProposal, {passive:true});
    function openProposal(){
      document.getElementById('proposal-poem').textContent = '"' + poemText.split('\n').slice(0,6).join(' ') + '..."';
      modal.classList.add('show');
      // tiny celebration at logo
      celebrateAtElement(document.querySelector('.logo'));
    }
    document.getElementById('no-btn').addEventListener('click', () => {
      const btn = document.getElementById('no-btn');
      btn.style.transform = `translate(${Math.random()*160-80}px, ${Math.random()*80-40}px)`;
      showToast('No is shy ‚Äî try again üôÇ');
    }, {passive:true});
    document.getElementById('yes-btn').addEventListener('click', () => {
      modal.classList.remove('show');
      celebrateYes();
      setTimeout(() => showFinalScreen(), 420);
    }, {passive:true});

    function celebrateYes(){
      for(let i=0;i<120;i++){
        setTimeout(()=> spawnPetal(rand(0, window.innerWidth), -40, 1.6), i*8);
      }
      showToast('She said YES ‚Äî fireworks of tulips!');
    }

    function showFinalScreen(){
      const full = document.createElement('div');
      full.style.position = 'fixed'; full.style.inset = 0; full.style.zIndex = 999999; full.style.display = 'flex';
      full.style.alignItems = 'center'; full.style.justifyContent = 'center'; full.style.flexDirection = 'column';
      full.style.background = 'linear-gradient(180deg, rgba(7,3,10,0.96), rgba(6,2,9,0.98))';
      full.innerHTML = `<div style="text-align:center;color:white;max-width:980px;padding:24px">
        <h1 style="font-size:40px;margin-bottom:8px;color:var(--accent)">Ria ‚Äî will you marry me?</h1>
        <p style="color:rgba(255,255,255,0.8);font-size:18px;line-height:1.6">${poemText.replace(/\n/g,'<br/>')}</p>
        <div style="margin-top:18px">
          <button id="final-love" style="padding:12px 18px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#111;font-weight:700;">Always</button>
        </div>
      </div>`;
      document.body.appendChild(full);
      document.getElementById('final-love').addEventListener('click', () => {
        showToast('Forever starts now üå∑');
        full.animate([{opacity:1},{opacity:0}], { duration:1200, delay:1200 }).onfinish = () => full.remove();
      }, {passive:true});
    }

    /* ---------- Toast ---------- */
    let toastTimer = null;
    function showToast(text){
      let t = document.getElementById('site-toast');
      if(!t){
        t = document.createElement('div'); t.id = 'site-toast';
        t.style.position = 'fixed'; t.style.right = '18px'; t.style.bottom = '18px';
        t.style.padding = '12px 16px'; t.style.borderRadius = '12px';
        t.style.background = 'linear-gradient(90deg, rgba(0,0,0,0.6), rgba(255,255,255,0.02))';
        t.style.color = 'white'; t.style.zIndex = 999999; t.style.maxWidth = '78%'; t.style.fontSize = '14px';
        document.body.appendChild(t);
      }
      t.textContent = text;
      t.animate([{opacity:0, transform:'translateY(8px)'},{opacity:1, transform:'translateY(0)'}], {duration:260});
      if(toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> {
        t.animate([{opacity:1, transform:'translateY(0)'},{opacity:0, transform:'translateY(8px)'}], {duration:380}).onfinish = () => t.remove();
      }, 3200);
    }

    /* ---------- Audio (WebAudio) ---------- */
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioCtx();
    let playing = false, musicTimer = null;
    function playTune(){
      if(!AudioCtx) { showToast('Audio not supported'); return; }
      if(playing){
        audioCtx.suspend(); playing = false; document.getElementById('play-music').textContent = 'Play music';
        if(musicTimer) { clearInterval(musicTimer); musicTimer = null; }
        return;
      }
      audioCtx.resume().then(()=> {
        playing = true; document.getElementById('play-music').textContent = 'Pause music';
        const master = audioCtx.createGain(); master.gain.value = 0.22; master.connect(audioCtx.destination);
        const notes = [220, 329.63, 440, 659.25, 880];
        let i = 0;
        musicTimer = setInterval(()=>{
          const osc = audioCtx.createOscillator();
          const gain = audioCtx.createGain();
          osc.type = 'sine';
          osc.frequency.value = notes[i % notes.length];
          osc.connect(gain); gain.connect(master);
          const now = audioCtx.currentTime;
          gain.gain.setValueAtTime(0.0001, now);
          gain.gain.exponentialRampToValueAtTime(0.12, now + 0.02);
          gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.9);
          osc.start(now); osc.stop(now + 1.1);
          i++;
          if(!playing){
            clearInterval(musicTimer); musicTimer = null;
          }
        }, 420);
      }).catch(err => {
        console.warn('Audio resume error', err);
      });
    }
    document.getElementById('play-music').addEventListener('click', playTune, {passive:true});

    /* ---------- Small interactions ---------- */
    poemEl.addEventListener('dblclick', () => { openProposal(); showToast('You found the secret line ‚Äî I get shy now'); }, {passive:true});
    document.addEventListener('click', (e) => {
      const s = document.createElement('div');
      s.style.position = 'fixed'; s.style.left = e.clientX + 'px'; s.style.top = e.clientY + 'px';
      s.style.width = '8px'; s.style.height = '8px'; s.style.borderRadius = '50%';
      s.style.background = 'radial-gradient(circle at 30% 30%, #fff, rgba(255,90,150,0.9))';
      s.style.zIndex = 999999; s.style.pointerEvents = 'none';
      document.body.appendChild(s);
      s.animate([{opacity:1, transform:'translateY(0) scale(1)'},{opacity:0, transform:'translateY(-30px) scale(.5)'}], {duration:900}).onfinish = () => s.remove();
    }, {passive:true});

    // small logo celebrate when hover (desktop)
    const logo = document.querySelector('.logo');
    let logoTimer = null;
    logo.addEventListener('mouseenter', () => {
      // on mobile, hover won't fire
      celebrateAtElement(logo);
      if(logoTimer) clearTimeout(logoTimer);
      logoTimer = setTimeout(() => { /* no-op to avoid spam */ }, 600);
    }, {passive:true});

    // init
    setupMemory();

    // ensure canvas initial sizing correct (in some environments)
    setTimeout(resizeCanvas, 120);
  })();
  </script>
</body>
</html>
